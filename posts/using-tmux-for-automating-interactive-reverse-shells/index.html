<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Using tmux for automating interactive reverse shells" /><meta name="author" content="Odysseus" /><meta property="og:locale" content="en" /><meta name="description" content="Automating the process of converting a non-interactive reverse shell to a fully interactive TTY." /><meta property="og:description" content="Automating the process of converting a non-interactive reverse shell to a fully interactive TTY." /><link rel="canonical" href="https://hackermindset.me/posts/using-tmux-for-automating-interactive-reverse-shells/" /><meta property="og:url" content="https://hackermindset.me/posts/using-tmux-for-automating-interactive-reverse-shells/" /><meta property="og:site_name" content="Hacker Mindset" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-02T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Using tmux for automating interactive reverse shells" /><meta name="twitter:site" content="@ualvesdias" /><meta name="twitter:creator" content="@Odysseus" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Odysseus"},"dateModified":"2022-05-09T04:55:11+00:00","datePublished":"2021-07-02T00:00:00+00:00","description":"Automating the process of converting a non-interactive reverse shell to a fully interactive TTY.","headline":"Using tmux for automating interactive reverse shells","mainEntityOfPage":{"@type":"WebPage","@id":"https://hackermindset.me/posts/using-tmux-for-automating-interactive-reverse-shells/"},"url":"https://hackermindset.me/posts/using-tmux-for-automating-interactive-reverse-shells/"}</script><title>Using tmux for automating interactive reverse shells | Hacker Mindset</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Hacker Mindset"><meta name="application-name" content="Hacker Mindset"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://raw.githubusercontent.com/ualvesdias/ualvesdias.github.io/main/assets/img/HAL9000.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Hacker Mindset</a></div><div class="site-subtitle font-italic">Experiment. Fail. Learn. Hack. Repeat.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/ualvesdias" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/ualvesdias" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ulisses.alves','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Using tmux for automating interactive reverse shells</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Using tmux for automating interactive reverse shells</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/ualvesdias">Odysseus</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1625184000" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2021-07-02 </em> </span> <span> Updated <em class="timeago" data-ts="1652072111" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-05-09 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="540 words"> <em>3 min</em> read</span></div></div></div><div class="post-content"><blockquote><p>Automating the process of converting a non-interactive reverse shell to a fully interactive TTY.</p></blockquote><p><img data-src="https://raw.githubusercontent.com/ualvesdias/ualvesdias.github.io/main/assets/img/321762811010236-1*NRbYPaweiL76Qh-RIFCY5g.png" alt="" data-proofer-ignore></p><h1 id="introduction">Introduction</h1><p>I’ve recently read agreat <a href="https://blog.polverari.com.br/en/posts/full-auto-interactive-tty/">post</a> about using the “expect” command line utility for automating the process of converting a non-interactive reverse shell to a fully interactive TTY, which means that by doing that, it’s possible to use features like tab completion, history navigation, clear the screen and, among others, being able to hit <strong><em>Ctrl-c</em></strong> without losing your access, which makes me really happy.</p><p>I’ve found the post very interesting because it uses a completely different approach that I had never seen before. So, since I also have a technique for automating this process, I decided to share it because it’s a different perspective, which also relies on a command line utility: <a href="https://github.com/tmux/tmux/wiki">tmux</a>.</p><h1 id="the-manual-process">The manual process</h1><p><img data-src="https://raw.githubusercontent.com/ualvesdias/ualvesdias.github.io/main/assets/img/1*oOdObCxGdkI6y2ogdF-Zdw.gif" alt="" data-proofer-ignore> <em>Creating an interactive reverse shell manually</em></p><p>The above gif shows how you can convert a non-interactive reverse shell into a interactive one. Although it’s a fairly simple process, if you have the need to do it very often, it becomes a pain.</p><h1 id="enter-tmux">Enter tmux</h1><p>Tmux is a terminal multiplexer command line utility that lets you create/control multiple shells from a single screen. One of its most powerful features is the ability to send keystrokes combinations into the shells automatically. Added to that is the feature that lets me create internal environment variables that I can use as short versions of big commands:</p><p><img data-src="https://raw.githubusercontent.com/ualvesdias/ualvesdias.github.io/main/assets/img/202273146628890-1*_e4dvKKDBEcKG4Qsm-QIKQ.png" alt="" data-proofer-ignore> <em>Command strings being stored as environment variables</em></p><p>Now I can simply open tmux command prompt and send one of those strings into the currently active tmux pane:</p><p><img data-src="https://raw.githubusercontent.com/ualvesdias/ualvesdias.github.io/main/assets/img/206062070718805-1*7oi2fFbRNkF9aRkkk89Lnw.gif" alt="" data-proofer-ignore> <em>Sending strings into shells using tmux</em></p><h1 id="the-magic-of-tmux-automation">The magic of tmux automation</h1><p>Now that we know all of the features we need to use from tmux, we can build tmux shortcuts, or key bindings, in order to trigger actions of sending keystrokes to the currently active pane.</p><p><img data-src="https://raw.githubusercontent.com/ualvesdias/ualvesdias.github.io/main/assets/img/30017873620209-1*H_zhGZ35Hza9TgdlsLz3uA.png" alt="" data-proofer-ignore> <em>Tmux key bindings for sending keystrokes</em></p><p>The “tmux.conf” lines above consist of two environment variables that hold two strings that will be send to the terminal later and two key bindings that will first send the key sequence <strong>_python3 -c ‘import pty;pty.spawn(\”/bin/bash\”)’_</strong> followed by a <strong>_&lt;Enter&gt;_</strong>, and then send the sequence <strong>_C-z “stty raw -echo” Enter fg Enter reset Enter $shellexports Enter_</strong>. Note that “Enter” is not the word itself, but the *keystroke*, that is, a newline character. Tmux has a set of words that it recognizes as certain keyboard keys and “Enter” is one of them.</p><p>The first <em>bind</em> command has to be executed after the prefix key combination, which in standard tmux is <strong><em>Ctrl-b</em></strong>, but in my case is <strong><em>Ctrl-a</em></strong>. The second <em>bind</em> command, which has the flag <em>-n</em> can be executed without the prefix combination.</p><p>Here you might be thinking: “but why are you using two shortcuts instead of just one that sends everything at once?” The answer for that is simple: I wasn’t able to get it working by using only one key binding. If you find a way, please contact me because I’d love to know what I’ve missed.</p><h1 id="the-final-result">The final result</h1><p>Now every time you get a non-interactive shell, you can simply hit <strong><em>Ctrl-aqq</em></strong> in order to trigger the first binding (<strong><em>Ctrl-aq</em></strong>) and then sending the second part (<strong><em>Ctrl-q</em></strong>). Enjoy:</p><p><img data-src="https://raw.githubusercontent.com/ualvesdias/ualvesdias.github.io/main/assets/img/204721341810793-1*m6JNfZPRqZ6B5ahCfP2CMQ.gif" alt="" data-proofer-ignore> <em>Fully automated interactive shell from a non-interactive one</em></p><hr /><p><strong>\x07\x44\x42\x01\x59\x13\x44</strong></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/linux/'>Linux</a>, <a href='/categories/infosec/'>Infosec</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/terminal/" class="post-tag no-text-decoration" >terminal</a> <a href="/tags/tmux/" class="post-tag no-text-decoration" >tmux</a> <a href="/tags/pentest/" class="post-tag no-text-decoration" >pentest</a> <a href="/tags/reverse-shell/" class="post-tag no-text-decoration" >reverse-shell</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Using tmux for automating interactive reverse shells - Hacker Mindset&amp;url=https://hackermindset.me/posts/using-tmux-for-automating-interactive-reverse-shells/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Using tmux for automating interactive reverse shells - Hacker Mindset&amp;u=https://hackermindset.me/posts/using-tmux-for-automating-interactive-reverse-shells/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://hackermindset.me/posts/using-tmux-for-automating-interactive-reverse-shells/&amp;text=Using tmux for automating interactive reverse shells - Hacker Mindset" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/white-box-penetration-testing-cheating-in-order-to-boost-impact-and-value/">White Box Penetration Testing: 'Cheating' in order to boost impact and value</a><li><a href="/posts/using-aws-api-gateway-as-a-bypass-for-ip-based-rate-limiting/">Using AWS API Gateway as a bypass for IP based rate limiting</a><li><a href="/posts/matchbox-machine-that-learns/">A Matchbox Machine that Learns</a><li><a href="/posts/bypassing-mobile-phone-number-verification/">Bypassing Phone Number Verification</a><li><a href="/posts/using-tmux-for-automating-interactive-reverse-shells/">Using tmux for automating interactive reverse shells</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/pentest/">pentest</a> <a class="post-tag" href="/tags/infosec/">infosec</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/api-gateway/">api-gateway</a> <a class="post-tag" href="/tags/authorization/">authorization</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/burp-suite/">burp-suite</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/documentation/">documentation</a> <a class="post-tag" href="/tags/learning/">learning</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/learning-from-your-mistakes/"><div class="card-body"> <em class="timeago small" data-ts="1609113600" > 2020-12-28 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Learning from your mistakes as an offensive security professional</h3><div class="text-muted small"><p> Introduction In both my personal and professional lives I try my best to live by a simple statement: “Your failures are the building blocks of your success”. But having a nice motivational quote m...</p></div></div></a></div><div class="card"> <a href="/posts/bypassing-mobile-phone-number-verification/"><div class="card-body"> <em class="timeago small" data-ts="1556107200" > 2019-04-24 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Bypassing Phone Number Verification</h3><div class="text-muted small"><p> In this post I’ll show you how I bypassed the phone number verification process in a website. I’m also going to explain why this was possible and what we can do to prevent this type of vulnerabi...</p></div></div></a></div><div class="card"> <a href="/posts/white-box-penetration-testing-cheating-in-order-to-boost-impact-and-value/"><div class="card-body"> <em class="timeago small" data-ts="1612483200" > 2021-02-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>White Box Penetration Testing: 'Cheating' in order to boost impact and value</h3><div class="text-muted small"><p> Almost every professional pentester is always thrilled when a black box pentesting comes along, however it’s probably in white box that you’ll be able to give your reports more meaning. Introduc...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/white-box-penetration-testing-cheating-in-order-to-boost-impact-and-value/" class="btn btn-outline-primary" prompt="Older"><p>White Box Penetration Testing: 'Cheating' in order to boost impact and value</p></a> <a href="/posts/kaseya-supply-chain-attack/" class="btn btn-outline-primary" prompt="Newer"><p>Kaseya Supply Chain Attack</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/ualvesdias">Odysseus</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/pentest/">pentest</a> <a class="post-tag" href="/tags/infosec/">infosec</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/api-gateway/">api-gateway</a> <a class="post-tag" href="/tags/authorization/">authorization</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/burp-suite/">burp-suite</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/documentation/">documentation</a> <a class="post-tag" href="/tags/learning/">learning</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
